#summary JSON Components.
#labels Cocoa,iPhone,iPad,JSON,jsonrpc4j,JSONKit,REST

= Introduction =

This section contains utility [http://code.google.com/p/oxeniphonecommons/source/browse/trunk/main/Classes/JSON/ JSON components].


= JSON RPC Proxy =

The [http://code.google.com/p/oxeniphonecommons/source/browse/trunk/main/Classes/JSON/OxICJsonRpcProxy.m OxICJsonRpcProxy] class provides a proxy for transparently accessing HTTP based JSON services. It uses the message format defined by [http://json-rpc.org/ JSON RPC] (well, in fact, we just used [http://code.google.com/p/jsonrpc4j/ jsonrpc4j] in order to test it - the component development is stil in progress).

The proxy intercepts the messages, puts the selector name as method name, converts the selector arguments into JSON and sends it over HTTP. When it receives the response, it converts the JSON response into the proper Objective C equivalent object.

The selector name sent to the server is modified in order to make it Java-friendly. Colons are removed and character after colons are capitalized. For example, if the selector name is sayHi:withMessage:, it will be translated into sayHiWithMessage(String, String) method.

In order to perform JSON conversion, the proxy uses the (fast and simple!) [https://github.com/johnezang/JSONKit JSONKit] parser. JSONKit, like most Objective C based JSON parsers, marshals/unmarshals data from/to [http://developer.apple.com/library/mac/#documentation/cocoa/reference/foundation/classes/nsdictionary_class/Reference/Reference.html NSDictionary] instances. Because of this, we developed some [DictionaryComponents dictionary components]. The JSON RPC proxy copies arguments into a NSDictionary before sending them using the [http://code.google.com/p/oxeniphonecommons/source/browse/trunk/main/Classes/Dictionary/OxICDictionaryConverter.m OxICDictionaryConverter] class. In a similar way, responses containing dictionaries are wrapped into a proxy using [http://code.google.com/p/oxeniphonecommons/source/browse/trunk/main/Classes/Dictionary/OxICDictionaryProxy.m OxICDictionaryProxy].

The proxy has two boolean properties:
 * capitalizeMethods: Converts first letter in method names to uppercase.
 * capitalizeFields: Converts  first letter in field names to uppercase (in fact, it sets the same property in NSDictionary proxies/adapters)
These properties can be helpful if your service uses Pascal case convention (for example, .NET conventions).



== Using the proxy ==
=== Standalone ===
You must provide the protocol to be proxied, the URL used to make HTTP post, and a [Wrapper wrapper factory]. You provide them using the following init method:

{{{
- (id) initWithProtocol: (Protocol*) aProtocol
                 andURL: (NSString*) aURL
      andWrapperFactory:(id<OxICWrapperFactory>) aWrapperFactory;
}}}

NOTE: Protocol is currently used just for creating a proper [http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSMethodSignature_Class/Reference/Reference.html NSMethodSignature].

=== With the IoC container ===
You can instantiate a JSON RPC proxy from the [Container IoC container] using the [http://code.google.com/p/oxeniphonecommons/source/browse/trunk/main/Classes/JSON/OxICJsonRpcProxyFactoryObject.m OxICJsonRpcProxyFactoryObject] class. Just add a definition simliar to the following one:

{{{
[newContainer addDefinition: [OxICObjectDefinition withName: @"authenticationService"
                                                   andClass: @"OxICJsonRpcProxyFactoryObject"
                                               andSingleton: NO
                                                    andLazy: NO
                                              andReferences: nil
                                                  andValues: [NSDictionary dictionaryWithObjectsAndKeys:
                                                               @"http://multivac.com/authentication", @"url",
                                                               @protocol(AuthenticationService), @"protocol",
                                                               wrapperFactory, @"wrapperFactory",
                                                             nil]]
];

}}}

Capitalization properties are available in the factory too.

= JSON REST Proxy =
The [http://code.google.com/p/oxeniphonecommons/source/browse/trunk/main/Classes/JSON/OxICJsonRestProxy.m OxICJsonRestProxy] works in a similar way, but it uses a REST-like approach.

The invoked method is appended to the URL (with a slash). The argument is sent as pure JSON. Likewise, the response is treated as pure JSON too.

Currently, this proxy supports methods with only one argument, so you will need to build DTOs in most cases.

The proxy has two boolean properties (just like the RCP proxy):
 * capitalizeMethods: Converts first letter in method names to uppercase.
 * capitalizeFields: Converts  first letter in field names to uppercase (in fact, it sets the same property in NSDictionary proxies/adapters)
These properties can be helpful if your service uses Pascal case convention (for example, .NET conventions).


== Using the proxy ==
=== Standalone ===
You must provide the protocol to be proxied, the URL used to make HTTP post, and a [Wrapper wrapper factory]. You provide them using the following init method:

{{{
- (id) initWithProtocol: (Protocol*) aProtocol
                 andURL: (NSString*) aURL
      andWrapperFactory:(id<OxICWrapperFactory>) aWrapperFactory;
}}}

NOTE: Protocol is currently used just for creating a proper [http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSMethodSignature_Class/Reference/Reference.html NSMethodSignature].

=== With the IoC container ===
You can instantiate a JSON REST proxy from the [Container IoC container] using the [http://code.google.com/p/oxeniphonecommons/source/browse/trunk/main/Classes/JSON/OxICJsonRestProxyFactoryObject.m OxICJsonRestProxyFactoryObject] class. Just add a definition simliar to the following one:

{{{
[newContainer addDefinition: [OxICObjectDefinition withName: @"authenticationService"
                                                   andClass: @"OxICJsonRestProxyFactoryObject"
                                               andSingleton: NO
                                                    andLazy: NO
                                              andReferences: nil
                                                  andValues: [NSDictionary dictionaryWithObjectsAndKeys:
                                                               @"http://multivac.com/authentication", @"url",
                                                               @protocol(AuthenticationService), @"protocol",
                                                               wrapperFactory, @"wrapperFactory",
                                                             nil]]
];

}}}

Capitalization properties are available in the factory too.